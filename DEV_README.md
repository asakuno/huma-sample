# 🚀 Development Environment Setup\n\nこのブランチは開発環境用の設定です。モックCognitoを使用して、実際のAWS Cognitoなしでも動作します。\n\n## 📋 Quick Start\n\n### 1. 環境変数の確認\n```bash\n# .envファイルが自動作成されますが、必要に応じて編集してください\ncat .env\n```\n\n### 2. 開発環境の起動\n```bash\n# 方法1: Makefileを使用（推奨）\nmake dev-start\n\n# 方法2: スクリプトを直接実行\n./scripts/dev-start.sh\n\n# 方法3: Docker Composeを直接使用\ndocker-compose up -d\n```\n\n### 3. API テスト\n```bash\n# 自動テストの実行\nmake dev-test\n\n# または手動でテスト\ncurl -X POST http://localhost:8888/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\": \"admin\", \"password\": \"password123\"}'\n```\n\n## 🔧 利用可能なサービス\n\n| サービス | URL | 説明 |\n|---------|-----|------|\n| 🌐 API Server | http://localhost:8888 | メインAPI |\n| 📖 API Docs | http://localhost:8888/docs | Swagger UI |\n| 🗄️ Database Admin | http://localhost:8080 | Adminer (DB管理) |\n| 🔄 Nginx Proxy | http://localhost:80 | リバースプロキシ |\n\n## 👥 テストユーザー（Mock Cognito）\n\n| Username | Password | Role |\n|----------|----------|------|\n| `admin` | `password123` | 管理者 |\n| `testuser` | `password123` | 一般ユーザー |\n| `developer` | `password123` | 開発者 |\n\n## 🛠️ 開発コマンド\n\n### 基本操作\n```bash\nmake help              # 利用可能なコマンド一覧\nmake dev-start         # 開発環境開始\nmake dev-stop          # 開発環境停止\nmake dev-restart       # 開発環境再起動\nmake dev-logs          # ログ表示\nmake dev-test          # APIテスト実行\nmake dev-clean         # 環境クリーンアップ\n```\n\n### データベース操作\n```bash\nmake db-connect        # MySQL CLI接続\nmake db-reset          # データベースリセット\nmake db-backup         # バックアップ作成\nmake db-adminer        # Adminer起動\n```\n\n### ビルド・テスト\n```bash\nmake build             # アプリケーションビルド\nmake test              # 単体テスト\nmake test-int          # 統合テスト\n```\n\n## 🔍 API エンドポイント\n\n### 認証 (Authentication)\n- `POST /auth/login` - ログイン\n- `POST /auth/logout` - ログアウト\n- `GET /auth/me` - プロフィール取得\n- `PUT /auth/me` - プロフィール更新\n- `POST /auth/refresh` - トークンリフレッシュ\n- `POST /auth/forgot-password` - パスワードリセット\n- `POST /auth/confirm-forgot-password` - パスワードリセット確認\n\n### 管理者 (Admin)\n- `POST /admin/users` - ユーザー作成\n\n### 一般 (Public)\n- `GET /health` - ヘルスチェック\n- `GET /greeting/{name}` - 公開挨拶\n- `GET /api/v1/greeting/{name}` - 保護された挨拶（認証必要）\n\n## 🧪 テスト例\n\n### 1. ログインテスト\n```bash\ncurl -X POST http://localhost:8888/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"username\": \"admin\",\n    \"password\": \"password123\"\n  }'\n```\n\n### 2. 保護されたエンドポイントのテスト\n```bash\n# まずログインしてトークンを取得\nTOKEN=$(curl -s -X POST http://localhost:8888/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\": \"admin\", \"password\": \"password123\"}' | jq -r '.access_token')\n\n# トークンを使って保護されたエンドポイントにアクセス\ncurl -X GET http://localhost:8888/auth/me \\\n  -H \"Authorization: Bearer $TOKEN\"\n```\n\n### 3. 管理者機能のテスト\n```bash\n# 管理者でログイン\nADMIN_TOKEN=$(curl -s -X POST http://localhost:8888/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\": \"admin\", \"password\": \"password123\"}' | jq -r '.access_token')\n\n# 新しいユーザーを作成\ncurl -X POST http://localhost:8888/admin/users \\\n  -H \"Authorization: Bearer $ADMIN_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"username\": \"newuser\",\n    \"email\": \"newuser@example.com\",\n    \"first_name\": \"New\",\n    \"last_name\": \"User\"\n  }'\n```\n\n## 🗄️ データベース管理\n\n### Adminerを使用\n1. http://localhost:8080 にアクセス\n2. 接続情報:\n   - **Server**: `mysql`\n   - **Username**: `user`\n   - **Password**: `password`\n   - **Database**: `database`\n\n### MySQL CLIを使用\n```bash\nmake db-connect\n# または\ndocker-compose exec mysql mysql -u user -ppassword database\n```\n\n## 📊 ログの確認\n\n```bash\n# 全てのサービスのログ\nmake dev-logs\n\n# アプリケーションのみ\ndocker-compose logs -f app\n\n# データベースのみ\ndocker-compose logs -f mysql\n```\n\n## 🚨 トラブルシューティング\n\n### よくある問題\n\n1. **ポートが既に使用されている**\n   ```bash\n   # 使用中のポートを確認\n   lsof -i :8888\n   lsof -i :3306\n   lsof -i :8080\n   ```\n\n2. **データベース接続エラー**\n   ```bash\n   # MySQLコンテナのログを確認\n   docker-compose logs mysql\n   \n   # コンテナの再起動\n   make dev-restart\n   ```\n\n3. **認証エラー**\n   - モックCognitoが有効になっているか確認\n   - 環境変数 `APP_ENV=development` が設定されているか確認\n   - テストユーザーの認証情報を確認\n\n### 環境のリセット\n```bash\n# 完全にクリーンアップして再開始\nmake dev-clean\nmake dev-start\n```\n\n## 🔄 本番環境への切り替え\n\n本番環境で使用する場合は、以下を変更してください：\n\n1. **環境変数の更新**\n   ```env\n   APP_ENV=production\n   MOCK_COGNITO=false\n   COGNITO_USER_POOL_ID=実際のUserPoolID\n   COGNITO_CLIENT_ID=実際のClientID\n   COGNITO_CLIENT_SECRET=実際のClientSecret\n   ```\n\n2. **AWS認証情報の設定**\n   ```env\n   AWS_ACCESS_KEY_ID=実際のアクセスキー\n   AWS_SECRET_ACCESS_KEY=実際のシークレットキー\n   ```\n\n## 📝 開発メモ\n\n- モックCognitoは開発専用です\n- データベースのデータは `app-data-dev` ボリュームに保存されます\n- 本番環境では必ず実際のAWS Cognitoを使用してください\n- セキュリティのため、本番環境では環境変数を適切に管理してください\n\n## 🤝 コントリビューション\n\n1. `dev` ブランチから新しいフィーチャーブランチを作成\n2. 変更を実装\n3. テストを実行: `make test`\n4. プルリクエストを作成\n\n---\n\n**Happy Coding! 🎉**\n"